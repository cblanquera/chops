/**
 * Chops - Client HTML5 on Push State
 *
 * @version 0.0.1
 * @author Christian Blanquera <cblanquera@openovate.com>
 * @license MIT
 */
!function(){var t=function(){var t=jQuery,i=!1;this.___construct=function(){i=!0,this._hijackPushState(),this._hijackPopState(),this._hijackLinks(),this._hijackForms(),this.on("request",function(){i=!1}).trigger("request")},this.on=function(i,n){return t(window).on(i,n),this},this.once=function(i,n){return t(window).one(i,n),this},this.off=function(i,n){return n?(t(window).unbind(i,n),this):(t(window).unbind(i),this)},this.trigger=function(){return t(window).trigger.apply(t(window),arguments),this},this._hijackPushState=function(){var i=window.history.pushState;window.history.pushState=function(n,e,o){"function"==typeof window.history.onpushstate&&window.history.onpushstate({state:n});var a=i.apply(window.history,arguments),r=jQuery.Event("request");return r.state=n,t(window).trigger(r,[o,n]),a}},this._hijackPopState=function(){window.onpopstate=function(n){if(i)return void(i=!1);var e=jQuery.Event("request");e.state=n.state,t(window).trigger(e,[window.location.href,window.history.state])}},this._hijackLinks=function(){t(document).on("click","a",function(t){if(!t.originalEvent.stop&&0===this.href.indexOf(window.location.origin)){t.preventDefault();var i={url:this.href,query:"",method:"GET",data:{flattened:{},expanded:{},serialized:{},json:{}}};-1!==i.url.indexOf("?")&&(i.query=i.url.split("?")[1]);for(var e,o={},a=i.query.split("&"),r=0;r<a.length;r++)e=a[r].split("="),o[e.shift()]=e.join("=");i.data.serialized=i.data.flattened=o,i.data.json=i.data.expanded=n(i.data.serialized),window.history.pushState(i,"",this.href)}})},this._hijackForms=function(){t(document.body).on("submit","form",function(i){if(!(t(this).attr("action")&&t(this).attr("action").length&&0!==t(this).attr("action").indexOf(window.location.origin)&&0!==t(this).attr("action").indexOf("/")||i.originalEvent.stop)){i.preventDefault();var e={url:t(this).attr("action")||window.location.href,query:t(this).serialize(),method:t(this).attr("method")||"GET",data:{flattened:{},expanded:{},serialized:{},json:{}}};e.method=e.method.toUpperCase();for(var o=t(this).serializeArray(),a=0;a<o.length;a++)e.data.flattened[o[a].name]=o[a].value,e.data.serialized[o[a].name]=o[a].value;e.data.json=n(e.data.serialized),"GET"===e.method&&(-1!==e.url.indexOf("?")&&(e.url=e.url.split("?")[0]),e.url+="?"+e.query),t('input[type="file"]',this).each(function(){this.name&&this.name.length&&(e.data.flattened[this.name]=this.files)}),e.data.expanded=n(e.data.flattened),window.history.pushState(e,"",e.url)}})};var n=function(t){var i,n,e,o,a={};for(var r in t)if(t.hasOwnProperty(r)){if(-1===r.indexOf("[")){a[r]=t[r];continue}n=r.replace(/\]\[/g,".").replace(/\[/g,".").replace(/\]/g,""),e=n.split("."),o=a;for(var i=0;i<e.length;i++)"undefined"==typeof o[e[i]]&&(o[e[i]]="undefined"==typeof e[i+1]||isNaN(parseInt(e[i+1]))?{}:[]),i<e.length-1&&(o=o[e[i]]);o[e[i-1]]=t[r]}return a}};"function"==typeof define?define(["jquery","classified"],function(i,n){return function(){return n(t)()}}):"function"==typeof jQuery&&"function"==typeof jQuery.extend?jQuery.extend({chops:function(){return this.classified(t)()}}):"object"==typeof window&&(window.chops=function(){return window.classified(t)()})}();