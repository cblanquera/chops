/**
 * Chops - Client HTML5 on Push State
 *
 * @version 0.0.2
 * @author Christian Blanquera <cblanquera@openovate.com>
 * @website https://github.com/cblanquera/chops
 * @license MIT
 */
!function(){var t=function(){var t=jQuery;this.___construct=function(){this._hijackPushState(),this._hijackPopState(),this._hijackLinks(),this._hijackForms(),n(window.location.href)},this.on=function(i,n){return t(window).on(i,n),this},this.once=function(i,n){return t(window).one(i,n),this},this.off=function(i,n){return n?(t(window).unbind(i,n),this):(t(window).unbind(i),this)},this.trigger=function(){return t(window).trigger.apply(t(window),arguments),this},this._hijackPushState=function(){var i=window.history.pushState;window.history.pushState=function(n,e,o){"function"==typeof window.history.onpushstate&&window.history.onpushstate({state:n});var a=i.apply(window.history,arguments),r=jQuery.Event("request");return r.state=n,t(window).trigger(r,[o,n]),a}},this._hijackPopState=function(){window.onpopstate=function(i){var n=jQuery.Event("request");n.state=i.state,t(window).trigger(n,[window.location.href,window.history.state])}},this._hijackLinks=function(){t(document).on("click","a",function(t){t.originalEvent.stop||0===this.href.indexOf(window.location.origin)&&(t.preventDefault(),n(this.href))})},this._hijackForms=function(){t(document.body).on("submit","form",function(i){t(this).attr("action")&&t(this).attr("action").length&&0!==t(this).attr("action").indexOf(window.location.origin)&&0!==t(this).attr("action").indexOf("/")||i.originalEvent.stop||(i.preventDefault(),e(this))})};var i=function(t){var i,n,e,o,a={};for(var r in t)if(t.hasOwnProperty(r)){if(-1===r.indexOf("[")){a[r]=t[r];continue}n=r.replace(/\]\[/g,".").replace(/\[/g,".").replace(/\]/g,""),e=n.split("."),o=a;for(var i=0;i<e.length;i++)"undefined"==typeof o[e[i]]&&(o[e[i]]="undefined"==typeof e[i+1]||isNaN(parseInt(e[i+1]))?{}:[]),i<e.length-1&&(o=o[e[i]]);o[e[i-1]]=t[r]}return a},n=function(t){var n={url:t,query:"",method:"GET",data:{flattened:{},expanded:{},serialized:{},json:{}}};-1!==n.url.indexOf("?")&&(n.query=n.url.split("?")[1]),0===n.url.indexOf(window.location.origin)&&(n.url=n.url.substr(window.location.origin.length));var e={},o=[];n.query.length&&(o=n.query.split("&"));for(var a,r=0;r<o.length;r++)a=o[r].split("="),e[a.shift()]=a.join("=");n.data.serialized=n.data.flattened=e,n.data.json=n.data.expanded=i(n.data.serialized),window.history.pushState(n,"",t)},e=function(n){var e=t(n).attr("action")||window.location.href,o={url:e,query:t(n).serialize(),method:t(n).attr("method")||"GET",data:{flattened:{},expanded:{},serialized:{},json:{}}};o.method=o.method.toUpperCase(),0===o.url.indexOf(window.location.origin)&&(o.url=o.url.substr(window.location.origin.length));for(var a=t(n).serializeArray(),r=0;r<a.length;r++)o.data.flattened[a[r].name]=a[r].value,o.data.serialized[a[r].name]=a[r].value;o.data.json=i(o.data.serialized),"GET"===o.method&&(-1!==o.url.indexOf("?")&&(o.url=o.url.split("?")[0]),o.url+="?"+o.query),t('input[type="file"]',n).each(function(){if(this.name&&this.name.length)for(var t=0;t<this.files.length;t++)o.data.flattened[this.name+"["+t+"]"]=this.files[t]}),o.data.expanded=i(o.data.flattened),window.history.pushState(o,"",o.url)}};"function"==typeof define?define(["jquery","classified"],function(i,n){return function(){return n(t)()}}):"function"==typeof jQuery&&"function"==typeof jQuery.extend?jQuery.extend({chops:function(){return this.classified(t)()}}):"object"==typeof window&&(window.chops=function(){return window.classified(t)()})}();