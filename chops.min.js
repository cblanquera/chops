/**
 * Chops - Client HTML5 on Push State
 *
 * @version 0.0.8
 * @author Christian Blanquera <cblanquera@openovate.com>
 * @website https://github.com/cblanquera/chops
 * @license MIT
 */
!function(){var t=function(){var t=jQuery,n=!1;this.___construct=function(){this._hijackPushState(),this._hijackPopState(),this._hijackLinks(),this._hijackForms()},this.getState=function(t){return t?o(t):window.history.state&&"number"!=typeof window.history.state?window.history.state:o(window.location.href)},this.on=function(n,i){return t(window).on(n,i),this},this.once=function(n,i){return t(window).one(n,i),this},this.off=function(n,i){return i?(t(window).unbind(n,i),this):(t(window).unbind(n),this)},this.redirect=function(t){return r(t),this},this.trigger=function(){return t(window).trigger.apply(t(window),arguments),this},this.useHash=function(){return n=!0,this},this._hijackPushState=function(){var n=window.history.pushState;window.history.pushState=function(i,e,o){"function"==typeof window.history.onpushstate&&window.history.onpushstate({state:i});var r=n.apply(window.history,arguments),s=jQuery.Event("request");return s.state=i,t(window).trigger(s,[o,i]),r}},this._hijackPopState=function(){window.onpopstate=function(){var n=o(window.location.href),i=jQuery.Event("request");i.state=n,t(window).trigger(i,[window.location.href,n])}},this._hijackLinks=function(){t(document).on("click","a",function(t){t.originalEvent&&t.originalEvent.stop||0===this.href.indexOf(window.location.origin)&&(t.preventDefault(),r(this.href))})},this._hijackForms=function(){t(document.body).on("submit","form",function(n){t(this).attr("action")&&t(this).attr("action").length&&0!==t(this).attr("action").indexOf(window.location.origin)&&0!==t(this).attr("action").indexOf("/")||n.originalEvent.stop||(n.preventDefault(),s(this))})};var i=function(t){var n={};if(0==t.length)return{};for(var i,e,o,r,s,a,u=t.split("&"),h=0;h<u.length;h++){if(i=u[h].split("="),i[1]=i[1]||"",r=decodeURIComponent(i[0].replace(/\+/g,"%20")),s=decodeURIComponent(i[1].replace(/\+/g,"%20")),!i[1]){if(!i[0])continue;s=null}if("string"!=typeof s||!/^[\+\-]*[0-9\.]+$/.test(s)||/^0/.test(s)||s.indexOf(".")!==s.lastIndexOf(".")||isNaN(parseFloat(s))||-1==s.indexOf(".")?"string"!=typeof s||!/^[\+\-]*[0-9\.]+$/.test(s)||/^0/.test(s)||s.indexOf(".")!==s.lastIndexOf(".")||isNaN(parseFloat(s))||(s=parseInt(s)):s=parseFloat(s),-1!=r.indexOf("[")){for(e=r.split("["),current=n,a=0;a<e.length&&(r=e[a].replace("]",""),a+1!=e.length);a++)current[r]||(o={},("]"==e[a+1]||!isNaN(parseFloat(e[a+1].replace("]","")))&&isFinite(e[a+1].replace("]","")))&&(o=[]),current instanceof Array?current.push(o):current[r]=o),current=current instanceof Array?current[current.length-1]:current[r];current instanceof Array?current.push(s):current&&(current[r]=s)}else n[r]=s}return n},e=function(t,n){for(var i in t)t.hasOwnProperty(i)&&("string"==typeof t[i]&&0===t[i].indexOf("____CHOPS____")&&("undefined"==typeof n[t[i].substr(13)]&&delete t[i],t[i]=n[t[i].substr(13)]),"object"==typeof t[i]&&null!==t[i]&&e(t[i],n))},o=function(t){var e={url:t,path:t.split("#").shift().split("?").shift(),query:"",hash:"",json:"",method:"GET",data:{},serial:[],files:[]},o=window.location.protocol+"//"+window.location.hostname;window.location.port&&(o+=":"+window.location.port),0===e.path.indexOf(o)&&(e.path=e.path.substr(o.length).split("?")[0]),-1!==t.indexOf("#")&&(e.hash=t.split("#").pop()),n&&(e.path=e.hash.split("?")[0]||"/",e.hash=""),-1!==e.url.indexOf("?")&&(e.query=e.url.split("?")[1]),e.data=i(e.query),e.json=JSON.stringify(e.data);var r=[];e.query.length&&(r=e.query.split("&"));for(var s,a=0;a<r.length;a++)s=r[a].split("="),e.serial.push({name:s.shift(),value:s.join("=")});return e},r=function(t){var i=window.location.protocol+"//"+window.location.hostname;window.location.port&&(i+=":"+window.location.port),n&&(0===t.indexOf(i)?(t=t.substr(i.length),t=i+"/#"+t):t="/#"+t),0!==t.indexOf(i)&&(t=i+t);var e=o(t);window.history.pushState(e,"",t)},s=function(r){var s=t(r).attr("action")||window.location.href;if(n){var a=window.location.protocol+"//"+window.location.hostname;window.location.port&&(a+=":"+window.location.port),0===s.indexOf(a)?(s=s.substr(a.length),s=a+"/#"+s):s="/#"+s}var u=o(s);u.method=t(r).attr("method")||"GET",u.method=u.method.toUpperCase(),u.query=t(r).serialize(),u.serial=t(r).serializeArray(),u.data=i(u.query),u.json=JSON.stringify(u.data),"GET"===u.method&&(-1!==u.url.indexOf("?")&&(u.url=u.url.split("?")[0]),u.url+="?"+u.query);var h={query:u.query,items:{}};t('input[type="file"]',r).each(function(){if(this.name&&this.name.length)for(var t=0,n=0;n<this.files.length;n++)u.files.push({name:this.name+"[]",value:this.files[n]}),h.items[++t]=this.files[n],h.query+="&"+this.name+"[]=____CHOPS____"+t}),h.data=i(h.query),e(h.data,h.items),u.data=h.data,window.history.pushState(u,"",u.url)}};"function"==typeof define?define(["jquery","classified"],function(n,i){return i(t).singleton()}):"function"==typeof jQuery&&"function"==typeof jQuery.extend?jQuery.extend({chops:jQuery.classified(t).singleton()}):"object"==typeof window&&(window.chops=window.classified(t).singleton())}();