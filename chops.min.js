/**
 * Chops - Client HTML5 on Push State
 *
 * @version 0.0.4
 * @author Christian Blanquera <cblanquera@openovate.com>
 * @website https://github.com/cblanquera/chops
 * @license MIT
 */
!function(){var t=function(){var t=jQuery;this.___construct=function(){this._hijackPushState(),this._hijackPopState(),this._hijackLinks(),this._hijackForms()},this.getState=function(){return window.history.state?window.history.state:e(window.location.href)},this.on=function(n,i){return t(window).on(n,i),this},this.once=function(n,i){return t(window).one(n,i),this},this.off=function(n,i){return i?(t(window).unbind(n,i),this):(t(window).unbind(n),this)},this.redirect=function(t){return r(t),this},this.trigger=function(){return t(window).trigger.apply(t(window),arguments),this},this._hijackPushState=function(){var n=window.history.pushState;window.history.pushState=function(i,e,r){"function"==typeof window.history.onpushstate&&window.history.onpushstate({state:i});var o=n.apply(window.history,arguments),s=jQuery.Event("request");return s.state=i,t(window).trigger(s,[r,i]),o}},this._hijackPopState=function(){window.onpopstate=function(){var n=e(window.location.href),i=jQuery.Event("request");i.state=n,t(window).trigger(i,[window.location.href,n])}},this._hijackLinks=function(){t(document).on("click","a",function(t){t.originalEvent.stop||0===this.href.indexOf(window.location.origin)&&(t.preventDefault(),r(this.href))})},this._hijackForms=function(){t(document.body).on("submit","form",function(n){t(this).attr("action")&&t(this).attr("action").length&&0!==t(this).attr("action").indexOf(window.location.origin)&&0!==t(this).attr("action").indexOf("/")||n.originalEvent.stop||(n.preventDefault(),o(this))})};var n=function(t){var n={};if(0==t.length)return{};for(var i,e,r,o,s,a,u=t.split("&"),h=0;h<u.length;h++){if(i=u[h].split("="),i[1]=i[1]||"",o=decodeURIComponent(i[0].replace(/\+/g,"%20")),s=decodeURIComponent(i[1].replace(/\+/g,"%20")),!i[1]){if(!i[0])continue;s=null}if("string"!=typeof s||!/^[\+\-]*[0-9\.]+$/.test(s)||/^0/.test(s)||s.indexOf(".")!==s.lastIndexOf(".")||isNaN(parseFloat(s))||-1==s.indexOf(".")?"string"!=typeof s||!/^[\+\-]*[0-9\.]+$/.test(s)||/^0/.test(s)||s.indexOf(".")!==s.lastIndexOf(".")||isNaN(parseFloat(s))||(s=parseInt(s)):s=parseFloat(s),-1!=o.indexOf("[")){for(e=o.split("["),current=n,a=0;a<e.length&&(o=e[a].replace("]",""),a+1!=e.length);a++)current[o]||(r={},("]"==e[a+1]||!isNaN(parseFloat(e[a+1].replace("]","")))&&isFinite(e[a+1].replace("]","")))&&(r=[]),current instanceof Array?current.push(r):current[o]=r),current=current instanceof Array?current[current.length-1]:current[o];current instanceof Array?current.push(s):current&&(current[o]=s)}else n[o]=s}return n},i=function(t,n){for(var e in t)t.hasOwnProperty(e)&&("string"==typeof t[e]&&0===t[e].indexOf("____CHOPS____")&&("undefined"==typeof n[t[e].substr(13)]&&delete t[e],t[e]=n[t[e].substr(13)]),"object"==typeof t[e]&&null!==t[e]&&i(t[e],n))},e=function(t){var i={url:t,path:t.split("?").shift(),query:"",json:"",method:"GET",data:{},serial:[],files:[]},e=window.location.protocol+"//"+window.location.hostname;window.location.port&&(e+=":"+window.location.port),0===i.path.indexOf(e)&&(i.path=i.path.substr(e.length)),-1!==i.url.indexOf("?")&&(i.query=i.url.split("?")[1]),0===i.url.indexOf(window.location.origin)&&(i.url=i.url.substr(window.location.origin.length)),i.data=n(i.query),i.json=JSON.stringify(i.data);var r=[];i.query.length&&(r=i.query.split("&"));for(var o,s=0;s<r.length;s++)o=r[s].split("="),i.serial.push({name:o.shift(),value:o.join("=")});return i},r=function(t){var n=e(t);window.history.pushState(n,"",t)},o=function(r){var o=t(r).attr("action")||window.location.href,s=e(o);s.method=t(r).attr("method")||"GET",s.method=s.method.toUpperCase(),s.query=t(r).serialize(),s.serial=t(r).serializeArray(),s.data=n(s.query),s.json=JSON.stringify(s.data),"GET"===s.method&&(-1!==s.url.indexOf("?")&&(s.url=s.url.split("?")[0]),s.url+="?"+s.query);var a={query:s.query,items:{}};t('input[type="file"]',r).each(function(){if(this.name&&this.name.length)for(var t=0,n=0;n<this.files.length;n++)s.files.push({name:this.name+"[]",value:this.files[n]}),a.items[++t]=this.files[n],a.query+="&"+this.name+"[]=____CHOPS____"+t}),a.data=n(a.query),i(a.data,a.items),s.data=a.data,window.history.pushState(s,"",s.url)}};"function"==typeof define?define(["jquery","classified"],function(n,i){return function(){return i(t)()}}):"function"==typeof jQuery&&"function"==typeof jQuery.extend?jQuery.extend({chops:function(){return this.classified(t)()}}):"object"==typeof window&&(window.chops=function(){return window.classified(t)()})}();